<div class="box" id="fullscreen-div">
  <audio
    #viewerAudio
    (loadedmetadata)="onAudioLoadMetadata()"
    [volume]="volume$ | ngrxPush"
    [playbackRate]="currentSpeed$ | ngrxPush"
  >
    <source
      *ngIf="project?.media?.video"
      src="{{ project?.media?.video }}"
      type="video/mp4"
    />
  </audio>
  <!--  -->

  <div class="position-relative">
    <div class="loading-spinner" *ngIf="viewerAudio.readyState === 1">
      <mat-spinner mode="indeterminate"></mat-spinner>
    </div>
    <button
      *ngIf="!isFullscreenActive()"
      #trigger="matMenuTrigger"
      class="views-menu-button {{ trigger.menuOpen ? 'menu-open' : '' }}"
      mat-button
      [matMenuTriggerFor]="viewsMenu"
    >
      <span>Weitere Ansichten</span> <mat-icon svgIcon="more"></mat-icon>
    </button>

    <mat-menu #viewsMenu="matMenu">
      <div
        class="mat-menu-item-wrapper"
        (click)="onClickMenuItem($event, null)"
        mat-menu-item
      >
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="onChangeViewsMenu($event.checked, null)"
          [checked]="!hiddenVideos.includes('mainVideo')"
          [disabled]="mainVideoId === 'mainVideo'"
        >
          Hauptvideo
        </mat-checkbox>
      </div>

      <div
        class="mat-menu-item-wrapper"
        mat-menu-item
        *ngFor="let video of project?.media?.additionalVideos"
        (click)="onClickMenuItem($event, video)"
      >
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="onChangeViewsMenu($event.checked, video)"
          [checked]="!hiddenVideos.includes(video.id)"
          [disabled]="mainVideoId === video.id"
        >
          {{ video.title }}
        </mat-checkbox>
      </div>
    </mat-menu>

    <div class="video-wrapper" [style.max-height.px]="mainVideoHeight">
      <!-- main video start -->
      <video
        #mainVideo
        *ngIf="mainVideoId === 'mainVideo'"
        class="main-video"
        [muted]="true"
        [playbackRate]="currentSpeed$ | ngrxPush"
        (loadedmetadata)="onVideoLoadMetadata($event)"
      >
        <source src="{{ project?.media?.video }}" type="video/mp4" />
      </video>

      <ng-container *ngFor="let video of project?.media?.additionalVideos">
        <video
          #mainVideo
          *ngIf="video.id === mainVideoId"
          class="main-video"
          [muted]="true"
          [playbackRate]="currentSpeed$ | ngrxPush"
          (loadedmetadata)="onVideoLoadMetadata($event)"
        >
          <source src="{{ video.video }}" type="video/mp4" />
        </video>
      </ng-container>
      <!-- main video end -->
      <!-- secondary videos start -->
      <div
        class="secondary-videos"
        [style.width.%]="
          hiddenVideos.length === project?.media?.additionalVideos?.length
            ? 0
            : 100
        "
      >
        <!-- main video as secondary start -->

        <!-- single secondary video start -->
        <div class="secondary-video-container">
          <video
            *ngIf="
              !hiddenVideos.includes('mainVideo') && mainVideoId !== 'mainVideo'
            "
            #secondaryVideo
            class="secondary-video"
            [muted]="true"
            [playbackRate]="currentSpeed$ | ngrxPush"
            (loadedmetadata)="onVideoLoadMetadata($event)"
          >
            <source
              *ngIf="project?.media?.video"
              src="{{ project?.media?.video }}"
              type="video/mp4"
            />
          </video>
          <div class="video-overlay">
            <span> Hauptvideo </span>
            <button
              mat-stroked-button
              color="basic"
              (click)="onChangeMainVideo('mainVideo')"
              tabindex="0"
            >
              Als Hauptansicht
            </button>
          </div>
        </div>
        <!-- main video as secondary stop -->
        <div
          class="secondary-video-container"
          *ngFor="let video of project?.media?.additionalVideos"
        >
          <!-- single secondary video start -->
          <video
            *ngIf="!hiddenVideos.includes(video.id) && mainVideoId !== video.id"
            #secondaryVideo
            class="secondary-video"
            [muted]="true"
            [playbackRate]="currentSpeed$ | ngrxPush"
            (loadedmetadata)="onVideoLoadMetadata($event)"
          >
            <source src="{{ video.video }}" type="video/mp4" />
          </video>
          <div class="video-overlay">
            <span>
              {{ video.title }}
            </span>
            <button
              mat-stroked-button
              color="basic"
              (click)="onChangeMainVideo(video.id)"
            >
              Als Hauptansicht
            </button>
          </div>
          <!-- single secondary video end -->
        </div>
        <!-- secondary videos end -->
      </div>
    </div>
    <ng-container *ngIf="subtitlesEnabledInVideo$ | ngrxPush">
      <div
        *ngrxLet="combinedCaptionsStyling$ as combined"
        class="viewer-caption {{ combined.position }}"
      >
        <!-- over / under -->
        <span
          *ngrxLet="viewerService.currentCaption$ as currentCaption"
          class="fontsize-{{ combined.fontsize }} color-{{
            combined.color
          }} backgroundColor-{{ combined.backgroundColor }}"
        >
          {{ currentCaption?.text || '-' }}</span
        >
      </div>
    </ng-container>
  </div>

  <app-controls> </app-controls>
</div>
