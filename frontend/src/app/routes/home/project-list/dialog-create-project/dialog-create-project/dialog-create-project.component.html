<div mat-dialog-title>
  <div class="dialog-header">
    <div>
      <h1 i18n="@@dialogCreateProjectHeadline">New Project</h1>
    </div>

    <button
      mat-icon-button
      [mat-dialog-close]="true"
      aria-label="Close"
      i18n-aria-label="@@dialogCreateProjectCloseButton"
      [disabled]="loading"
    >
      <mat-icon svgIcon="close" />
    </button>
  </div>
</div>

<mat-dialog-content>
  <p class="intro-text">
    Check the "Use Audio" box to select the file from which you would like to
    use the audio track. Several files can be selected this way, which however
    can result in overlaps.
  </p>

  <form [formGroup]="formGroup">
    <label
      class="dropzone"
      [class.with-files]="formGroup.controls.files.value.length !== 0"
      [class.with-error]="
        formGroup.hasError('videoRequired') ||
        formGroup.hasError('useAudioRequired')
      "
    >
      @if (formGroup.controls.files.value.length === 0) {
      <p class="dropzone-text">
        Drop files * here
        <br />
        or
      </p>

      <span class="dropzone-label">Select files</span>
      } @else {
      <table
        mat-table
        [dataSource]="dataSource"
        class="file-table"
        (click)="onPreventBubble($event)"
      >
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Filename</th>
          <td mat-cell *matCellDef="let element">
            <div class="file-name">
              {{ element.get('name').value }}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let element" [formGroup]="element">
            @if (element.controls?.fileType.value === 'video') {
            <mat-form-field class="select-mat-form-field">
              <mat-select formControlName="category">
                @for (category of mediaCategoryArray; track category) {
                <mat-option value="category">{{
                  category | mediaCategory
                }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="language">
          <th mat-header-cell *matHeaderCellDef>Language</th>
          <td mat-cell *matCellDef="let element" [formGroup]="element">
            <mat-form-field class="select-mat-form-field">
              <mat-select formControlName="language">
                @for (lang of languages; track lang) {

                <mat-option [value]="lang.code">
                  {{ lang.name }}
                </mat-option>

                }
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="use-audio">
          <th mat-header-cell *matHeaderCellDef>Use Audio</th>
          <td mat-cell *matCellDef="let element" [formGroup]="element">
            @if (element.controls?.fileType.value === 'video') {
            <div class="align-center">
              <mat-checkbox formControlName="useAudio" class="checkbox" />
            </div>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef>Delete</th>
          <td mat-cell *matCellDef="let i = index">
            <div class="align-center">
              <button
                (click)="onRemoveFile(i)"
                mat-icon-button
                aria-label="delete"
              >
                <mat-icon svgIcon="delete" />
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <span class="dropzone-label">Select more files</span>
      }

      <input
        (change)="onAddFiles($event)"
        type="file"
        #dropzone
        multiple
        required
      />
    </label>
    <div class="error-wrapper">
      <p aria-live="polite" class="mat-error">
        @if(formGroup.hasError('videoRequired')) {<span>
          At least one video or audio file is required
        </span>
        } @if(formGroup.hasError('useAudioRequired')) {
        <span> At least one "use audio" source selected </span>
        }
      </p>
    </div>

    <mat-form-field class="title-form-field">
      <mat-label>Title</mat-label>
      <input matInput formControlName="title" />
      <button
        mat-icon-button
        matSuffix
        aria-label="Clear title"
        matTooltip="Clear title"
        (click)="onClearTitleField($event)"
      >
        <mat-icon svgIcon="clear"> </mat-icon>
      </button>
      <mat-error>Title is required</mat-error>
    </mat-form-field>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-flat-button color="primary">Create Project</button>
</mat-dialog-actions>
