<app-header>
  <span class="project-title" #projectTitle> Recorder </span>
  <div class="viewer-header-buttons"></div>
</app-header>
<section class="content">
  @if (loading) {
  <div class="flex justify-center" style="margin-top: 20px">
    <mat-spinner></mat-spinner>
  </div>
  } @if (!loading) {
  <div class="head-wrapper">
    <mat-form-field style="min-width: 300px">
      <mat-label>Aufnahmetitel</mat-label>
      <input
        matInput
        placeholder="Aufnahmetitel"
        [(ngModel)]="recordingTitle"
        required
      />
      <!-- value="Aufnahme vom {{ today | date }}" -->
    </mat-form-field>

    <div class="infotext">
      <mat-icon svgIcon="info"></mat-icon>
      @if (!this.recorderService.recording) {
      <span>
        You can add or delete sources. <br />
        To start the recording you need at least 1 visual and 1 auditive source.
      </span>
      }@else {
      <span>
        Recording ongoing. Press Stop recording if you want to save or dismiss
        your recording.
      </span>
      }
    </div>

    <!-- setup buttons -->
    <div class="buttons">
      <!-- record buttons -->

      @if (recorderService.recording) { @if(recorderService.recordingPaused){
      <mat-icon class="" svgIcon="pause"></mat-icon>
      }@else {
      <mat-icon
        class="svg-red recording-indicator"
        svgIcon="recording"
      ></mat-icon>
      }

      {{ getCurrentDuration() | duration }}}

      <!-- start & stop -->
      @if(recorderService.recording){

      <button
        class="action-btn"
        color="primary"
        mat-flat-button
        (click)="onClickStopRecord()"
        [disabled]="!recorderService.recording"
      >
        Stop Record
      </button>
      }@else {
      <button
        class="action-btn"
        color="primary"
        mat-flat-button
        (click)="onClickStartRecord()"
        [disabled]="recordingDisabled() || recorderService.recording"
      >
        Start Record
      </button>
      }
      <!-- pause & resume -->
      @if (recorderService.recordingPaused) {

      <button
        class="action-btn"
        color="primary"
        mat-flat-button
        [disabled]="
          !recorderService.recording ||
          (recorderService.recording && !recorderService.recordingPaused)
        "
        (click)="onClickTogglePauseRecording()"
      >
        Resume Record
      </button>
      }@else {
      <button
        class="action-btn"
        color="primary"
        mat-flat-button
        [disabled]="
          !recorderService.recording ||
          (recorderService.recording && recorderService.recordingPaused)
        "
        (click)="onClickTogglePauseRecording()"
      >
        Pause Record
      </button>

      }
    </div>
  </div>
  <hr />

  <div class="all-media-wrapper">
    <div class="media-category-wrapper">
      <h2>Audioquellen</h2>
      @if (recorderService.audios.length === 0) {
      <p>
        <i>Kein Audio hinzugefügt</i>
      </p>
      }
      <div class="media-list-wrapper">
        @for (audio of recorderService.audios; track audio; let index = $index)
        {
        <app-media-source [mediaSource]="audio"></app-media-source>
        }
      </div>
      <!--  -->
      @if (!recorderService.recording) {
      <button
        color="primary"
        class="add-btn"
        mat-flat-button
        (click)="onAddAudioSource()"
      >
        add microphone
      </button>
      }
    </div>
    <div class="media-category-wrapper">
      <h2>Videoquellen</h2>
      @if (recorderService.videos.length === 0) {
      <p>
        <i>Kein Video hinzugefügt</i>
      </p>
      }
      <div class="media-list-wrapper">
        @for (video of recorderService.videos; track video; let index = $index)
        {
        <app-media-source [mediaSource]="video"></app-media-source>
        }
      </div>
      <!--  -->
      @if (!recorderService.recording ) {
      <button
        color="primary"
        class="add-btn"
        mat-flat-button
        (click)="onAddVideoSource()"
      >
        add video
      </button>
      }
    </div>
    <div class="media-category-wrapper">
      <h2>Screensharingquellen</h2>
      @if (recorderService.screensharings.length === 0) {
      <p>
        <i>Kein Screensharing hinzugefügt</i>
      </p>
      }
      <div class="media-list-wrapper">
        @for ( screen of recorderService.screensharings; track screen; let index
        = $index) {
        <app-media-source [mediaSource]="screen"></app-media-source>
        }
      </div>
      <!--  -->
      @if (!recorderService.recording) {
      <button
        class="add-btn"
        color="primary"
        mat-flat-button
        (click)="onAddScreenSharingSource()"
      >
        add screen sharing
      </button>
      }
    </div>
  </div>
  }
</section>
