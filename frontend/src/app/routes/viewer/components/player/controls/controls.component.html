@if (viewerService.audio) {
<div class="controls">
  <!--mat-progress-bar mode="determinate" value="40"></mat-progress-bar-->
  <div class="video-progress-slider-wrapper">
    <span class="time-info">{{
      viewerService.audio.currentTime * 1000 | duration : 'mm:ss'
    }}</span>
    <mat-slider
      class="video-progress-slider black"
      min="0"
      [max]="viewerService.audio.duration"
      discrete
      [displayWith]="audioProgressLabel"
    >
      <input
        aria-label="Video timeline"
        i18n-aria-label="@@viewerControlsTimelineLabel"
        matSliderThumb
        [(ngModel)]="viewerService.audio.currentTime"
      />
      <!-- (input)="onVideoProgressChange($event)" -->
    </mat-slider>
    <span class="time-info">{{
      viewerService.audio.duration * 1000 | duration : 'mm:ss'
    }}</span>
  </div>
  <div class="main-controls">
    <div class="left">
      @if (viewerService.audio.paused) {
      <button
        mat-icon-button
        class="md"
        matTooltip="Play"
        i18n-matTooltip="@@viewerControlsPlayPauseTooltipPlay"
        (click)="onPlayVideo()"
      >
        <mat-icon svgIcon="play"></mat-icon></button
      >}@else {
      <button
        mat-icon-button
        class="md"
        matTooltip="Pause"
        i18n-matTooltip="@@viewerControlsPlayPauseTooltip"
        (click)="onPauseVideo()"
      >
        <mat-icon svgIcon="pause"></mat-icon>
      </button>
      }

      <!-- sound -->
      <button
        mat-icon-button
        class="md"
        matTooltip="{{
          viewerService.audio.muted ? 'Unmute sound' : 'Mute sound'
        }}"
        (click)="onMuteAudio()"
        i18n-matTooltip="@@viewerControlsMuteUnmuteTooltip"
      >
        @if (!viewerService.audio.muted) {
        <mat-icon svgIcon="volume"></mat-icon>
        } @if (viewerService.audio.muted) {
        <mat-icon svgIcon="volume-mute"></mat-icon>
        }
      </button>
      <mat-slider
        class="volume-slider black"
        min="0"
        max="1"
        step="0.01"
        discrete
        [displayWith]="sliderLabelVolume"
        [disabled]="viewerService.audio.muted"
      >
        <input
          aria-label="Volume"
          i18n-aria-label="@@viewerControlsVolumeSlideLabel"
          matSliderThumb
          [value]="volume$ | ngrxPush"
          (change)="onVolumeChange($event)"
        />
      </mat-slider>
    </div>
    <div class="center"></div>
    <div class="right">
      <button
        mat-icon-button
        class="md"
        [matMenuTriggerFor]="languageMenu"
        (menuOpened)="onMenuOpened()"
        (menuClosed)="onMenuClosed()"
      >
        <mat-icon svgIcon="speechbubble"></mat-icon>
      </button>

      <button
        mat-icon-button
        class="md"
        [matMenuTriggerFor]="galleryMenu"
        matTooltip="Shown video selection"
        i18n-matTooltip="@@viewerControlsGalleryMenuTooltip"
        (menuOpened)="onMenuOpened()"
        (menuClosed)="onMenuClosed()"
      >
        <mat-icon svgIcon="gallery"></mat-icon>
      </button>

      <button
        mat-icon-button
        class="md"
        [matMenuTriggerFor]="settingsMenu"
        (menuOpened)="onMenuOpened()"
        (menuClosed)="onMenuClosed()"
        matTooltip="Settings Menu"
        i18n-matTooltip="@@viewerControlsSettingsMenuTooltip"
      >
        <mat-icon svgIcon="setting"></mat-icon>
      </button>

      @if (viewerService.isFullscreenActive()) {
      <button
        mat-icon-button
        class="md fullscreen-button"
        (click)="viewerService.onRequestFullscreen()"
        matTooltip="Close fullscreen"
        i18n-matTooltip="@@viewerControlsFullscreenToggleTooltipActive"
      >
        <mat-icon svgIcon="fullscreen_close"></mat-icon>
      </button>
      }@else {
      <button
        mat-icon-button
        class="md fullscreen-button"
        (click)="viewerService.onRequestFullscreen()"
        matTooltip="Open fullscreen"
        i18n-matTooltip="@@viewerControlsFullscreenToggleTooltipInactive"
      >
        <mat-icon svgIcon="fullscreen"></mat-icon>
      </button>
      }
    </div>
  </div>
  <!-- <div class="information-row">
    <div>
      {{ viewerService.audio.currentTime * 1000 | duration }} /
      {{
        viewerService.audio.duration
          ? (viewerService.audio.duration * 1000 | duration)
          : '-'
      }}
    </div>
    @if (viewerService.audio.paused) {
    <div i18n="@@viewerControlsPausedInfo">Paused</div>
    } @else {
    <div i18n="@@viewerControlsStartedInfo">Started</div>
    }
  </div> -->
</div>
}

<!-- MENUS -->

<!-- LANGUAGE MENU -->
<mat-menu #languageMenu="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="audioMenu">Audio</button>
  <button mat-menu-item [matMenuTriggerFor]="textlanguageMenu">
    Textlanguage
  </button>
  <button mat-menu-item [matMenuTriggerFor]="captionsMenu">Captions</button>
  <button mat-menu-item [matMenuTriggerFor]="transcriptMenu">Transcript</button>
</mat-menu>

<mat-menu #audioMenu="matMenu">
  <!-- foreach audios -->
  <button mat-menu-item>
    <mat-icon svgIcon="{{ true ? 'check' : '' }}"></mat-icon>German
  </button>
</mat-menu>

<mat-menu #textlanguageMenu="matMenu">
  <!-- foreach transcriptions -->
  <ng-container *ngrxLet="transcriptions$ as transcriptions">
    @for (transcription of transcriptions.list; track $index) {
    <button mat-menu-item (click)="onChangeTranscription(transcription)">
      <mat-icon
        svgIcon="{{
          transcription.id === transcriptions.selectedId ? 'check' : ''
        }}"
      ></mat-icon
      >{{ transcription.language }} ({{ transcription.title }})
    </button>
    }
  </ng-container>
</mat-menu>

<mat-menu #captionsMenu="matMenu">
  <ng-container *ngrxLet="subtitlesEnabledInVideo$ as subtitlesEnabledInVideo">
    <button
      mat-menu-item
      (click)="onChangeCaptions(false, subtitlesEnabledInVideo)"
    >
      <mat-icon
        svgIcon="{{ !subtitlesEnabledInVideo ? 'check' : '' }}"
      ></mat-icon
      >Aus
    </button>
    <button
      mat-menu-item
      (click)="onChangeCaptions(true, subtitlesEnabledInVideo)"
    >
      <mat-icon
        svgIcon="{{ subtitlesEnabledInVideo ? 'check' : '' }}"
      ></mat-icon
      >An
    </button>
  </ng-container>
  <button mat-menu-item (click)="onOpenCaptionsSettingsDialog()">
    <mat-icon svgIcon=""></mat-icon>Einstellungen
  </button>
</mat-menu>

<mat-menu #transcriptMenu="matMenu">
  <ng-container *ngrxLet="transcriptPosition$ as transcriptPosition">
    <button
      mat-menu-item
      (click)="onChangeTranscriptPosition(tanscriptPositionENUM.OFF)"
    >
      <mat-icon
        svgIcon="{{
          transcriptPosition === tanscriptPositionENUM.OFF ? 'check' : ''
        }}"
      ></mat-icon
      >Aus
    </button>
    <button
      mat-menu-item
      (click)="onChangeTranscriptPosition(tanscriptPositionENUM.LEFT)"
    >
      <mat-icon
        svgIcon="{{
          transcriptPosition === tanscriptPositionENUM.LEFT ? 'check' : ''
        }}"
      ></mat-icon
      >Links
    </button>
    <button
      mat-menu-item
      (click)="onChangeTranscriptPosition(tanscriptPositionENUM.RIGHT)"
    >
      <mat-icon
        svgIcon="{{
          transcriptPosition === tanscriptPositionENUM.RIGHT ? 'check' : ''
        }}"
      ></mat-icon
      >Rechts
    </button>
    <button mat-menu-item (click)="onOpenTranscriptSettingsDialog()">
      <mat-icon svgIcon=""></mat-icon>Einstellungen
    </button></ng-container
  >
</mat-menu>

<!-- SETTINGS MENU -->
<mat-menu #settingsMenu="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="darkmodeMenu">Darkmode</button>
  <button mat-menu-item [matMenuTriggerFor]="playspeedMenu">Playspeed</button>
  <button mat-menu-item>Hilfe</button>
</mat-menu>

<mat-menu #darkmodeMenu="matMenu">
  <ng-container *ngrxLet="darkMode$ as darkMode">
    <button mat-menu-item>
      <mat-icon svgIcon="{{ false ? 'check' : '' }}"></mat-icon>Automatisch
    </button>
    <button mat-menu-item (click)="onToggleDarkmode(darkMode, false)">
      <mat-icon svgIcon="{{ !darkMode ? 'check' : '' }}"></mat-icon>Hell
    </button>
    <button mat-menu-item (click)="onToggleDarkmode(darkMode, true)">
      <mat-icon svgIcon="{{ darkMode ? 'check' : '' }}"></mat-icon>Dunkel
    </button>
  </ng-container>
</mat-menu>

<mat-menu #playspeedMenu="matMenu">
  <ng-container *ngrxLet="currentSpeed$ as currentSpeed">
    @for (speed of [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]; track speed) {
    <button mat-menu-item (click)="changePlaybackSpeed(speed)">
      <mat-icon
        svgIcon="{{ currentSpeed === speed ? 'check' : '' }}"
      ></mat-icon>
      <span> {{ speed }}x</span>
    </button>
    }
  </ng-container>
</mat-menu>

<!-- GALLERY MENU  -->
<mat-menu #galleryMenu="matMenu">
  <!-- //TODO Wollen wir hier das main video anzeigen?  -->
  @for (video of smallVideos$ | ngrxPush; track video) {
  <div
    class="mat-menu-item-wrapper"
    mat-menu-item
    (click)="onClickToggleVideoShown($event, video)"
    (keydown)="onKeypressToggleVideoShown($event, video)"
  >
    <!-- (change)="onCheckToggleVideoShown($event, video)" -->
    <mat-checkbox [checked]="video.shown">
      {{ video.title }}
      @if (video.category === 'sign_language') {
      <mat-icon svgIcon="sign_language"></mat-icon>
      }
    </mat-checkbox>
  </div>
  }
</mat-menu>
