<h2>Translate an existing transcription</h2>

<form [formGroup]="transcriptionGroup">
  <mat-form-field class="transcription-dropdown">
    <mat-label>Transcription</mat-label>
    <mat-select formControlName="transcription">
      @for (transcription of transcriptionList; track transcription) {
      <mat-option [value]="transcription.id"
        >{{ transcription.language }} | {{ transcription.title }}</mat-option
      >
      }
    </mat-select>
    <mat-error>Select a transcription</mat-error>
  </mat-form-field>
  <div
    class="vendor-language-wrapper"
    *ngrxLet="translationServices$ as translationServices"
  >
    <mat-form-field>
      <mat-label>Vendor</mat-label>
      <mat-select
        formControlName="translationVendor"
        (valueChange)="transcriptionGroup.get('language')?.reset()"
      >
        <!-- reset language field if vendor changes -->
        @for (service of translationServices; track service) {
        <mat-option value="{{ service.translateVendor }}">
          {{ service.fullName }}
        </mat-option>
        }
      </mat-select>
      <mat-hint>Languages are vendor dependent </mat-hint>
      <mat-error>Select a vendor</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Language</mat-label>

      <mat-select
        [disabled]="
          transcriptionGroup.controls['translationVendor'].value === ''
        "
        formControlName="language"
        (selectionChange)="onSelectLanguage($event.value)"
      >
        <!-- show languages depeding on chosen vendor -->
        @if( translationLanguages$ | ngrxPush; as translationLanguages ) { @for
        (language of translationLanguages; track language) {
        <mat-option value="{{ language.code }}">
          {{ language.code | writtenOutLanguage }} ({{ language.code }})
        </mat-option>
        } }
      </mat-select>

      @if(transcriptionGroup.controls['translationVendor'].value === '') {
      <mat-hint>Select a vendor first</mat-hint>
      }

      <mat-error>Select a language </mat-error>
    </mat-form-field>
  </div>
  <mat-form-field>
    <mat-label>Title</mat-label>
    <input matInput formControlName="title" />

    @if(transcriptionGroup.controls['title'].value !== '') {
    <button type="button" mat-icon-button matSuffix (click)="onClearTitle()">
      <mat-icon svgIcon="close-small" />
    </button>
    }
    <mat-error>Title is required</mat-error>
  </mat-form-field>
</form>
