<h2>Upload a new transcription</h2>

@if(loading) {
<p>Uploads</p>
<mat-progress-bar
  mode="determinate"
  [value]="uploadProgress"
></mat-progress-bar>
} @else {
<form [formGroup]="transcriptionGroup">
  <div class="language-title-wrapper">
    <mat-form-field>
      <mat-label>Language</mat-label>
      <mat-select
        (selectionChange)="onSelectLanguage($event.value)"
        formControlName="language"
      >
        @for (language of languages; track language) {
        <mat-option [value]="language.code"
          >{{ language.code | writtenOutLanguage }} ({{
            language.code
          }})</mat-option
        >
        }
      </mat-select>
      <mat-error>Select a language</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Title</mat-label>
      <input matInput formControlName="title" />
      @if(transcriptionGroup.controls['title'].value !== '') {
      <button type="button" mat-icon-button matSuffix (click)="onClearTitle()">
        <mat-icon svgIcon="close-small" />
      </button>
      }
      <mat-error>Title is required</mat-error>
    </mat-form-field>
  </div>

  <div class="file-dropzone-wrapper">
    <app-upload-files
      formControlName="file"
      [acceptedFileFormats]="acceptedFileFormats"
      [acceptOnlyOneFile]="true"
      ariaDesribedByIds="transcript-file-error-maximum transcript-file-error-required"
      label="transcription"
    />
  </div>
  <!-- TODO find a better solution for ariadesribedby with these ids -->
  <div class="file-errors-wrapper">
    @if(transcriptionGroup.controls['file'].hasError('maxlength')){
    <p id="transcript-file-error-maximum" aria-live="polite">Maximum 1 file</p>
    } @if(transcriptionGroup.controls['file'].hasError('required') &&
    transcriptionGroup.controls['file'].touched){
    <p id="transcript-file-error-required" aria-live="polite">
      A transcription file (.vtt or .srt) is required
    </p>
    }
  </div>
</form>
}
