<div class="container">
  <h1 i18n="@@createTranscriptionModalTitle" mat-dialog-title>
    Add transcription
  </h1>

  <form [formGroup]="transcriptionGroup" (ngSubmit)="onCreateTranscription()">
    <mat-radio-group
      #createOptionsGroup
      formControlName="createOption"
      class="create-transcript-options"
    >
      <div class="radio-button-container">
        <mat-radio-button
          value="upload-transcript"
          radioGroup="createOptionsGroup"
          class="radio-create-option"
          i18n="@@createTranscriptionUploadRadioButton"
        >
          <div class="radio-button-content">
            <mat-icon svgIcon="upload-transcription"> </mat-icon>
            Upload
          </div></mat-radio-button
        >
      </div>
      <div class="radio-button-container">
        <mat-radio-button
          value="copy-transcript"
          radioGroup="createOptionsGroup"
          class="radio-create-option"
          i18n="@@createTranscriptionCopyRadioButton"
        >
          <div class="radio-button-content">
            <mat-icon svgIcon="copy-transcription"> </mat-icon>
            Copy
          </div></mat-radio-button
        >
      </div>

      <div class="radio-button-container">
        <mat-radio-button
          value="translate-transcript"
          radioGroup="createOptionsGroup"
          class="radio-create-option"
          i18n="@@createTranscriptionTranslateRadioButton"
        >
          <div class="radio-button-content">
            <mat-icon svgIcon="translate-transcription"> </mat-icon>
            Translate
          </div></mat-radio-button
        >
      </div>
      <div class="radio-button-container">
        <mat-radio-button
          value="create-from-video"
          radioGroup="createOptionsGroup"
          class="radio-create-option"
          i18n="@@createTranscriptionFromVideoRadioButton"
        >
          <div class="radio-button-content">
            <mat-icon svgIcon="video"> </mat-icon>
            Create from audio/video
          </div>
        </mat-radio-button>
      </div>
    </mat-radio-group>

    <div [ngSwitch]="transcriptionGroup.get('createOption')?.value">
      <h2
        *ngSwitchCase="'upload-transcript'"
        i18n="@@createTranscriptionUploadHeader"
      >
        Upload file (.vtt, .srt)
      </h2>
      <h2
        *ngSwitchCase="'copy-transcript'"
        i18n="@@createTranscriptionCopyHeader"
      >
        Copy existing transcription
      </h2>
      <h2
        *ngSwitchCase="'translate-transcript'"
        i18n="@@createTranscriptionTranslateHeader"
      >
        Translate to other language
      </h2>
      <h2
        *ngSwitchCase="'create-from-video'"
        i18n="@@createTranscriptionFromVideoHeader"
      >
        Create from audio/video (Speech-To-Text)
      </h2>
    </div>

    <!-- language (upload transcription) and title -->
    <div
      [class.no-language]="
        transcriptionGroup.get('createOption')?.value !== 'upload-transcript'
      "
      class="language-title-wrapper"
    >
      <mat-form-field
        *ngIf="
          transcriptionGroup.get('createOption')?.value === 'upload-transcript'
        "
      >
        <mat-label i18n="@@createTranscriptionModalLanguageLabel"
          >Language</mat-label
        >
        <mat-select
          (selectionChange)="onSelectLanguage($event.value)"
          formControlName="language"
        >
          <mat-option *ngFor="let language of languages" [value]="language.code"
            >{{ language.name }} ({{ language.code }})</mat-option
          >
        </mat-select>
        <mat-error i18n="@@createTranscriptionModalLanguageError"
          >Select a language</mat-error
        >
      </mat-form-field>

      <mat-form-field class="title">
        <mat-label i18n="@@createTranscriptionModalTitleLabel">Title</mat-label>
        <input matInput formControlName="title" />
        <mat-error i18n="@@createTranscriptionModalTitleError"
          >Add a title to the transcription</mat-error
        >
      </mat-form-field>
    </div>

    <!-- Switch case depending on radio button selection -->
    <div [ngSwitch]="transcriptionGroup.get('createOption')?.value">
      <!-- ---------------------------- -->
      <!-- Upload Transcript File -->
      <!-- ---------------------------- -->
      <div *ngSwitchCase="'upload-transcript'">
        <div
          class="dropzone"
          [class.invalid-input]="
            transcriptionGroup.controls['transcriptionFiles'].dirty &&
            transcriptionGroup.controls['transcriptionFiles'].invalid
          "
          [class.valid-input]="
            transcriptionGroup.controls['transcriptionFiles'].valid &&
            transcriptionGroup.controls['transcriptionFiles'].dirty
          "
        >
          <div *ngIf="loading" class="spinner-wrapper">
            <mat-progress-spinner
              mode="determinate"
              value="{{ uploadProgress }}"
            ></mat-progress-spinner>
          </div>
          <div *ngIf="!loading">
            <div
              class="input-ready-dropzone"
              [class.empty]="
                transcriptionGroup.value.transcriptionFiles?.length === 0
              "
            >
              <div
                *ngIf="
                  transcriptionGroup.value.transcriptionFiles?.length !== 0
                "
              >
                <div
                  *ngFor="
                    let file of transcriptionGroup.value.transcriptionFiles
                  "
                  class="file"
                >
                  <div class="file-content">
                    <mat-icon svgIcon="transcription-file"></mat-icon>

                    <div>
                      {{ file.name }}
                    </div>
                  </div>
                  <button
                    mat-icon-button
                    (click)="
                      onRemoveFile(file, 'transcriptionFiles');
                      $event.stopPropagation()
                    "
                    i18n-matTooltip="
                      @@createTranscriptionModalRemoveFileTooltip"
                    matTooltip="Remove file"
                  >
                    <mat-icon svgIcon="delete"></mat-icon>
                  </button>
                </div>
              </div>

              <div>
                <input
                  type="file"
                  #fileDropRef
                  id="fileDropRef"
                  (change)="onAddTranscriptionFiles($event)"
                  required
                  accept=".vtt,.srt"
                />

                <mat-icon svgIcon="upload"></mat-icon>
                <div i18n="@@createTranscriptionModalDropzoneTranscription">
                  Drag transcription file * here
                </div>
                <div i18n="@@createTranscriptionModalDropzoneTranscription2">
                  or
                </div>
                <br />
                <label
                  for="fileDropRef"
                  i18n="@@createTranscriptionModalDropzoneTranscriptionButton"
                  >Choose file
                </label>
              </div>
            </div>
          </div>
        </div>
        <mat-error
          class="custom-mat-error"
          *ngIf="
            transcriptionGroup.controls['transcriptionFiles'].dirty &&
            transcriptionGroup.controls['transcriptionFiles'].hasError(
              'transcriptionRequired'
            )
          "
          i18n="@@createTranscriptionModalTranscriptionRequiredError"
        >
          At least one transcription file is required.
        </mat-error>

        <mat-error
          class="custom-mat-error"
          *ngIf="
            transcriptionGroup.controls['transcriptionFiles'].dirty &&
            transcriptionGroup.controls['transcriptionFiles'].hasError(
              'tooManyTranscriptions'
            )
          "
          i18n="@@createTranscriptionModalTooManyTranscriptionsError"
        >
          You can select maximum one transcription file.
        </mat-error>
        <div
          class="error-padding"
          [class.error-above]="
            (transcriptionGroup.controls['transcriptionFiles'].dirty &&
              transcriptionGroup.controls['transcriptionFiles'].hasError(
                'tooManyTranscriptions'
              )) ||
            (transcriptionGroup.controls['transcriptionFiles'].dirty &&
              transcriptionGroup.controls['transcriptionFiles'].hasError(
                'transcriptionRequired'
              ))
          "
        ></div>
      </div>

      <!-- ---------------------------- -->
      <!-- Copy Transcript -->
      <!-- ---------------------------- -->
      <div *ngSwitchCase="'copy-transcript'">
        <mat-form-field class="transcription-dropdown">
          <mat-label i18n="@@createTranscriptionModalCopyTranscriptionLabel"
            >Transcription</mat-label
          >
          <mat-select formControlName="transcription">
            <mat-option
              *ngFor="let transcription of transcriptionsList"
              [value]="transcription.id"
              >{{ transcription.language }} |
              {{ transcription.title }}</mat-option
            >
          </mat-select>
          <mat-error i18n="@@createTranscriptionModalCopyTranscriptionError"
            >Select a transcription</mat-error
          >
        </mat-form-field>
      </div>

      <!-- ---------------------------- -->
      <!-- Translate Transcript -->
      <!-- ---------------------------- -->
      <div
        class="translate-transcription"
        *ngSwitchCase="'translate-transcript'"
      >
        <mat-form-field class="transcription-dropdown">
          <mat-label
            i18n="@@createTranscriptionModalTranslateTranscriptionLabel"
            >Transcription</mat-label
          >
          <mat-select formControlName="transcription">
            <mat-option
              *ngFor="let transcription of transcriptionsList"
              [value]="transcription.id"
              >{{ transcription.language }} |
              {{ transcription.title }}</mat-option
            >
          </mat-select>
          <mat-error
            i18n="@@createTranscriptionModalTranslateTranscriptionError"
            >Select a transcription</mat-error
          >
        </mat-form-field>
        <div
          class="settings-wrapper"
          *ngrxLet="translationServices$ as translationServices"
        >
          <mat-form-field>
            <mat-label i18n="@@createTranscriptionModalTranslateVendorLabel"
              >Vendor</mat-label
            >
            <mat-select
              formControlName="translationVendor"
              (valueChange)="transcriptionGroup.get('language')?.reset()"
            >
              <!-- reset language field if vendor changes -->
              <mat-option
                *ngFor="let service of translationServices"
                value="{{ service.translateVendor }}"
                >{{ service.fullName }}</mat-option
              >
            </mat-select>
            <mat-hint i18n="@@createTranscriptionModalTranslateVendorHint">
              The available languages are vendor dependent
            </mat-hint>
            <mat-error i18n="@@createTranscriptionModalTranslateVendorError"
              >Select a vendor to translate the transcription</mat-error
            >
          </mat-form-field>
          <mat-form-field>
            <mat-label i18n="@@createTranscriptionModalTranslateLanguageLabel"
              >Language</mat-label
            >
            <mat-select
              [disabled]="
                transcriptionGroup.controls['translationVendor'].value === ''
              "
              formControlName="language"
            >
              <!-- show languages depeding on chosen vendor -->
              <ng-container>
                <mat-option
                  *ngFor="
                    let lang of extractLanguages(
                      translationServices,
                      transcriptionGroup.controls['translationVendor'].value
                    )
                  "
                  value="{{ lang.code }}"
                  >{{ lang.name }} ({{ lang.code }})</mat-option
                >
              </ng-container>
            </mat-select>
            <mat-error i18n="@@createTranscriptionModalTranslateLanguageError"
              >Select a language into which the transcript will be
              translated</mat-error
            >
          </mat-form-field>
        </div>
      </div>

      <!-- ---------------------------- -->
      <!-- Create Transcript from Video -->
      <!-- ---------------------------- -->
      <div *ngSwitchCase="'create-from-video'">
        <div
          class="dropzone"
          [class.invalid-input]="
            transcriptionGroup.controls['videoFiles'].dirty &&
            transcriptionGroup.controls['videoFiles'].invalid
          "
          [class.valid-input]="
            transcriptionGroup.controls['videoFiles'].valid &&
            transcriptionGroup.controls['videoFiles'].dirty
          "
        >
          <div *ngIf="!loading">
            <div
              class="input-ready-dropzone"
              [class.empty]="
                this.transcriptionGroup.value.videoFiles?.length === 0
              "
            >
              <div
                *ngIf="this.transcriptionGroup.value.videoFiles?.length !== 0"
              >
                <div
                  *ngFor="let file of this.transcriptionGroup.value.videoFiles"
                  class="file"
                >
                  <div class="file-content">
                    <mat-icon svgIcon="file_video"></mat-icon>
                    <div>
                      {{ file.name }}
                    </div>
                  </div>
                  <button
                    mat-icon-button
                    (click)="
                      onRemoveFile(file, 'videoFiles'); $event.stopPropagation()
                    "
                    i18n-matTooltip="
                      @@createTranscriptionModalRemoveFileTooltip"
                    matTooltip="Remove file"
                  >
                    <mat-icon svgIcon="delete"></mat-icon>
                  </button>
                </div>
              </div>

              <div>
                <input
                  type="file"
                  #fileDropRef
                  id="fileDropRef"
                  (change)="onAddVideoFiles($event)"
                  required
                  accept="audio/*,video/*"
                />

                <mat-icon svgIcon="upload"></mat-icon>
                <div i18n="@@createTranscriptionModalDropzoneVideo">
                  Drag video file * here
                </div>
                <div i18n="@@createTranscriptionModalDropzoneVideo2">or</div>
                <br />
                <label
                  for="fileDropRef"
                  i18n="@@createTranscriptionModalDropzoneVideoButton"
                  >Choose file
                </label>
              </div>
            </div>
          </div>
        </div>
        <mat-error
          class="custom-mat-error"
          *ngIf="
            transcriptionGroup.controls['videoFiles'].dirty &&
            transcriptionGroup.controls['videoFiles'].hasError('videoRequired')
          "
          i18n="@@createTranscriptionModalVideoRequiredError"
        >
          At least one video file is required.
        </mat-error>

        <mat-error
          class="custom-mat-error"
          *ngIf="
            transcriptionGroup.controls['videoFiles'].dirty &&
            transcriptionGroup.controls['videoFiles'].hasError('tooManyVideos')
          "
          i18n="@@createTranscriptionModalTooManyVideosError"
        >
          You can select maximum one video file.
        </mat-error>
        <div
          class="error-padding"
          [class.error-above]="
            (transcriptionGroup.controls['videoFiles'].dirty &&
              transcriptionGroup.controls['videoFiles'].hasError(
                'tooManyVideos'
              )) ||
            (transcriptionGroup.controls['videoFiles'].dirty &&
              transcriptionGroup.controls['videoFiles'].hasError(
                'videoRequired'
              ))
          "
        ></div>
        <div class="settings-wrapper">
          <mat-form-field>
            <mat-label i18n="@@createTranscriptionModalASRVendorLabel"
              >Vendor</mat-label
            >
            <mat-select formControlName="asrVendor">
              <mat-option value="Placeholder">DeepL</mat-option>
              <mat-option value="Placeholder2">Google</mat-option>
            </mat-select>
            <mat-hint i18n="@@createTranscriptionModalASRVendorHint">
              The available languages are vendor dependent
            </mat-hint>
            <mat-error i18n="@@createTranscriptionModalASRVendorError"
              >Select a vendor to transcribe the audio/video</mat-error
            >
          </mat-form-field>
          <mat-form-field>
            <mat-label i18n="@@createTranscriptionModalASRLanguageLabel"
              >Language</mat-label
            >
            <mat-select
              [disabled]="transcriptionGroup.controls['asrVendor'].value === ''"
              formControlName="language"
            >
              <mat-option value="Placeholder">German</mat-option>
              <mat-option value="Placeholder2">English</mat-option>
            </mat-select>
            <mat-error i18n="@@createTranscriptionModalASRLanguageError"
              >Select a language into which the audio/video will be transcribed
              to</mat-error
            >
          </mat-form-field>
        </div>
      </div>
    </div>

    <!-- ---------------------------- -->
    <!-- Submit button -->
    <!-- ---------------------------- -->
    <div class="submit-btn-wrapper">
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="!onValidInputForCreateOption()"
        i18n="@@createTranscriptionModalCreateTranscriptionButton"
      >
        Create transcription
      </button>
    </div>
  </form>
</div>
